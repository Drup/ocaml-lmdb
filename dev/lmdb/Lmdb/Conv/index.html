<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Conv (lmdb.Lmdb.Conv)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">lmdb</a> &#x00BB; <a href="../index.html">Lmdb</a> &#x00BB; Conv</nav><h1>Module <code>Lmdb.Conv</code></h1><p>Converters to and from the internal representation of keys and values. A converter contains serialising and deserialising functions as well as the flags applied when the converter is used in a map.</p><nav class="toc"><ul><li><a href="#types">Types</a></li><li><a href="#constructor-and-accessors">Constructor and accessors</a></li><li><a href="#predefined-converters">Predefined converters</a><ul><li><a href="#strings">Strings</a></li><li><a href="#integers">Integers</a></li></ul></li></ul></nav></header><section><header><h3 id="types"><a href="#types" class="anchor"></a>Types</h3></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> <span>'a t</span></code></dt><dt class="spec type" id="type-bigstring"><a href="#type-bigstring" class="anchor"></a><code><span class="keyword">type</span> bigstring</code><code> = <span><span>(char, Bigarray.int8_unsigned_elt, Bigarray.c_layout)</span> Bigarray.Array1.t</span></code></dt><dd><p>Bigstrings are used to transfer the raw serialised data into and out of the database. They may point directly to a memory-mapped region of the database file.</p></dd></dl><dl><dt class="spec module" id="module-Flags"><a href="#module-Flags" class="anchor"></a><code><span class="keyword">module</span> Flags = <a href="../../Lmdb__/Lmdb_bindings/index.html#module-DbiFlags">Lmdb__.Lmdb_bindings.DbiFlags</a></code></dt><dd><p>Flags describing the (sorting) properties of keys and values of a map.</p></dd></dl></section><section><header><h3 id="constructor-and-accessors"><a href="#constructor-and-accessors" class="anchor"></a>Constructor and accessors</h3></header><dl><dt class="spec value" id="val-make"><a href="#val-make" class="anchor"></a><code><span class="keyword">val</span> make : <span>?&#8288;flags:<a href="../../Lmdb__Lmdb_bindings/DbiFlags/index.html#type-t">Flags.t</a></span> <span>&#45;&gt;</span> <span>serialise:<span>(<span>(int <span>&#45;&gt;</span> <a href="index.html#type-bigstring">bigstring</a>)</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="index.html#type-bigstring">bigstring</a>)</span></span> <span>&#45;&gt;</span> <span>deserialise:<span>(<a href="index.html#type-bigstring">bigstring</a> <span>&#45;&gt;</span> <span class="type-var">'a</span>)</span></span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>make ~serialise ~deserialise</code> creates a converter from a serialising and a deserialising function</p><dl><dt>parameter serialise</dt><dd><p><code>serialise alloc x</code> <em>may</em> call <code>alloc len</code> <em>once</em> to allocate a <code>bigstring</code> of size <code>len</code>. It then <em>must</em> fill the serialised data of <code>x</code> into this <code>bigstring</code> and return <em>exactly this</em> bigstring. If <code>serialise</code> didn't call <code>alloc</code> it may return any <code>bigstring</code>. <code>alloc</code> may return uninitialised memory. It is therefore recommended that <code>serialise</code> overwrites all allocated memory to avoid leaking possibly sensitive memory content into the database.</p><p>If <code>serialise</code> calls <code>alloc</code> the library may utilise the <code>MDB_RESERVE</code> interface when appropriate to avoid calls to <code>malloc</code> and <code>memcpy</code>.</p></dd></dl><dl><dt>parameter deserialise</dt><dd><p>The passed <a href="index.html#type-bigstring"><code>bigstring</code></a> is only valid as long as the current transaction. It is therefore strongly recommended not to leak it out of <code>deserialise</code>.</p></dd></dl><dl><dt>parameter flags</dt><dd><p>Flags to be set on a map using this converter.</p><p>Depending on the use of a converter as <em>key</em> or <em>value</em> <a href="../Map/index.html#val-create"><code>Map.create</code></a> and <a href="../Map/index.html#val-open_existing"><code>Map.open_existing</code></a> will select the correct set of flags: <code>_key</code> flags will be used for keys and <code>_dup</code> flags will be used for values on maps supporting duplicates.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-serialise"><a href="#val-serialise" class="anchor"></a><code><span class="keyword">val</span> serialise : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>(int <span>&#45;&gt;</span> <a href="index.html#type-bigstring">bigstring</a>)</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="index.html#type-bigstring">bigstring</a></code></dt><dt class="spec value" id="val-deserialise"><a href="#val-deserialise" class="anchor"></a><code><span class="keyword">val</span> deserialise : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <a href="index.html#type-bigstring">bigstring</a> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dt class="spec value" id="val-flags"><a href="#val-flags" class="anchor"></a><code><span class="keyword">val</span> flags : <span><span class="type-var">_</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <a href="../../Lmdb__Lmdb_bindings/DbiFlags/index.html#type-t">Flags.t</a></code></dt></dl></section><section><header><h3 id="predefined-converters"><a href="#predefined-converters" class="anchor"></a>Predefined converters</h3></header><section><header><h4 id="strings"><a href="#strings" class="anchor"></a>Strings</h4></header><dl><dt class="spec value" id="val-bigstring"><a href="#val-bigstring" class="anchor"></a><code><span class="keyword">val</span> bigstring : <span><a href="index.html#type-bigstring">bigstring</a> <a href="index.html#type-t">t</a></span></code></dt><dd><p>The <code>bigstring</code> converter returns bigstrings as returned by the lmdb backend. These bigstrings point into the environment memory-map and are therefore only guaranteed to be valid until the transaction ends. If you need longer-lived values then use the <code>string</code> converter, make a copy or write a custom converter.</p></dd></dl><dl><dt class="spec value" id="val-string"><a href="#val-string" class="anchor"></a><code><span class="keyword">val</span> string : <span>string <a href="index.html#type-t">t</a></span></code></dt><dd><p>The <code>string</code> converter simply copies the raw database content from / to OCaml strings.</p></dd></dl></section><section><header><h4 id="integers"><a href="#integers" class="anchor"></a>Integers</h4></header><aside><p>The integer converters will make use of <a href="../../Lmdb__Lmdb_bindings/DbiFlags/index.html#type-t"><code>Flags.t</code></a> as appropriate so that integers are sorted in ascending order irrespective of machine endianness.</p></aside><dl><dt class="spec value" id="val-int32_be"><a href="#val-int32_be" class="anchor"></a><code><span class="keyword">val</span> int32_be : <span>Stdlib.Int32.t <a href="index.html#type-t">t</a></span></code></dt><dt class="spec value" id="val-int64_be"><a href="#val-int64_be" class="anchor"></a><code><span class="keyword">val</span> int64_be : <span>Stdlib.Int64.t <a href="index.html#type-t">t</a></span></code></dt><dt class="spec value" id="val-int32_le"><a href="#val-int32_le" class="anchor"></a><code><span class="keyword">val</span> int32_le : <span>Stdlib.Int32.t <a href="index.html#type-t">t</a></span></code></dt><dt class="spec value" id="val-int64_le"><a href="#val-int64_le" class="anchor"></a><code><span class="keyword">val</span> int64_le : <span>Stdlib.Int64.t <a href="index.html#type-t">t</a></span></code></dt></dl><aside><p>For convenience, the <code>_as_int</code> converters convert the internal integer representation to and from <code>int</code>.</p><dl><dt>raises Invalid_argument</dt><dd><p><code>Invalid_argument &quot;Lmdb: Integer out of bounds&quot;</code></p></dd></dl></aside><dl><dt class="spec value" id="val-int32_be_as_int"><a href="#val-int32_be_as_int" class="anchor"></a><code><span class="keyword">val</span> int32_be_as_int : <span>int <a href="index.html#type-t">t</a></span></code></dt><dt class="spec value" id="val-int64_be_as_int"><a href="#val-int64_be_as_int" class="anchor"></a><code><span class="keyword">val</span> int64_be_as_int : <span>int <a href="index.html#type-t">t</a></span></code></dt><dt class="spec value" id="val-int32_le_as_int"><a href="#val-int32_le_as_int" class="anchor"></a><code><span class="keyword">val</span> int32_le_as_int : <span>int <a href="index.html#type-t">t</a></span></code></dt><dt class="spec value" id="val-int64_le_as_int"><a href="#val-int64_le_as_int" class="anchor"></a><code><span class="keyword">val</span> int64_le_as_int : <span>int <a href="index.html#type-t">t</a></span></code></dt></dl></section></section></div></body></html>